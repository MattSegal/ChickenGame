!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./node_modules/babel-loader/lib/index.js!./src/worker.js")}({"./node_modules/@babel/runtime/helpers/arrayWithHoles.js":function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},"./node_modules/@babel/runtime/helpers/assertThisInitialized.js":function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},"./node_modules/@babel/runtime/helpers/classCallCheck.js":function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},"./node_modules/@babel/runtime/helpers/createClass.js":function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},"./node_modules/@babel/runtime/helpers/defineProperty.js":function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},"./node_modules/@babel/runtime/helpers/getPrototypeOf.js":function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},"./node_modules/@babel/runtime/helpers/inherits.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/setPrototypeOf.js");e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},"./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js":function(e,t){e.exports=function(e,t){var n=[],r=!0,o=!1,s=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,s=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw s}}return n}},"./node_modules/@babel/runtime/helpers/nonIterableRest.js":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},"./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/typeof.js"),o=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js");e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?o(e):t}},"./node_modules/@babel/runtime/helpers/setPrototypeOf.js":function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},"./node_modules/@babel/runtime/helpers/slicedToArray.js":function(e,t,n){var r=n("./node_modules/@babel/runtime/helpers/arrayWithHoles.js"),o=n("./node_modules/@babel/runtime/helpers/iterableToArrayLimit.js"),s=n("./node_modules/@babel/runtime/helpers/nonIterableRest.js");e.exports=function(e,t){return r(e)||o(e,t)||s()}},"./node_modules/@babel/runtime/helpers/typeof.js":function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},"./node_modules/babel-loader/lib/index.js!./src/worker.js":function(e,t,n){"use strict";n.r(t);var r={BOARD_LENGTH:14,MAX_LENGTH:900,TREE_DENSITY:.15},o=1e6,s=500,i="N",u="S",a="E",l="W",c={NORTH:[-1,0],SOUTH:[1,0],EAST:[0,1],WEST:[0,-1]},f={EMPTY:0,CHICKEN:1,FOX:2,TREE:3},h=n("./node_modules/@babel/runtime/helpers/classCallCheck.js"),d=n.n(h),p=n("./node_modules/@babel/runtime/helpers/createClass.js"),y=n.n(p),m=n("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),v=n.n(m),b=n("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),g=n.n(b),_=n("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),E=n.n(_),O=n("./node_modules/@babel/runtime/helpers/inherits.js"),w=n.n(O),T=n("./node_modules/@babel/runtime/helpers/defineProperty.js"),N=n.n(T),A=function(){function e(t,n){var r=this;d()(this,e),N()(this,"type",void 0),N()(this,"sprite",void 0),N()(this,"games",void 0),N()(this,"position",void 0),N()(this,"reset",function(){r.games=0}),this.type=n,this.sprite=t,this.games=0,this.position=[0,0]}return y()(e,[{key:"timestep",value:function(e,t,n,r){return null}},{key:"serialize",value:function(){return{games:this.games,type:this.type}}},{key:"deserialize",value:function(e){this.games=e.games}},{key:"endGame",value:function(){this.games++}},{key:"getValues",value:function(e){return null}}],[{key:"getManhattanDistance",value:function(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}},{key:"getNewPosition",value:function(e,t){return e?[t[0]+c[e][0],t[1]+c[e][1]]:t}},{key:"getActionFromPositions",value:function(e,t){return t[0]===e[0]+1&&t[1]===e[1]?u:t[0]===e[0]-1&&t[1]===e[1]?i:t[0]===e[0]&&t[1]===e[1]+1?a:t[0]===e[0]&&t[1]===e[1]-1?l:null}},{key:"samePosition",value:function(e,t){return e[0]==t[0]&&e[1]==t[1]}}]),e}(),P={ArrowDown:"SOUTH",ArrowUp:"NORTH",ArrowLeft:"WEST",ArrowRight:"EAST",s:"SOUTH",w:"NORTH",a:"WEST",d:"EAST"},S=function(e){function t(e,n){var r;return d()(this,t),r=v()(this,g()(t).call(this,e,n)),N()(E()(r),"chosenNextAction",void 0),N()(E()(r),"onKeyDown",function(e){r.chosenNextAction=P[e.key]||null}),r.chosenNextAction=null,document.addEventListener("keydown",r.onKeyDown),r}return w()(t,e),y()(t,[{key:"timestep",value:function(e,t,n,r){var o=null;return e(n[0],n[1]).includes(this.chosenNextAction)&&(o=this.chosenNextAction,this.chosenNextAction=null),o}}]),t}(A),j=n("./node_modules/@babel/runtime/helpers/slicedToArray.js"),R=n.n(j);function x(e){var t,n,r;for(r=e.length-1;r>0;r--)t=Math.floor(Math.random()*(r+1)),n=e[r],e[r]=e[t],e[t]=n;return e}function I(e){return e[Math.floor(Math.random()*e.length)]}var F=function(e){function t(e,n){var r;return d()(this,t),r=v()(this,g()(t).call(this,e,n)),N()(E()(r),"isFollowing",void 0),r.isFollowing=e===f.FOX,r}return w()(t,e),y()(t,[{key:"timestep",value:function(e,t,n,r){var o=n[0],s=n[1],c=r[0],f=r[1],h=this.isFollowing?o>c:o<=c,d=this.isFollowing?o<c:o>=c,p=this.isFollowing?s<f:s>=f,y=this.isFollowing?s>f:s<=f,m=e(o,s),v=[];return y&&m.includes(l)&&v.push(l),p&&m.includes(a)&&v.push(a),h&&m.includes(i)&&v.push(i),d&&m.includes(u)&&v.push(u),v.length<1?I(m):I(v)}}]),t}(A),M=function(e){function t(){return d()(this,t),v()(this,g()(t).apply(this,arguments))}return w()(t,e),y()(t,[{key:"timestep",value:function(e,t,n,r){return I(e(n[0],n[1]))}}]),t}(A),H=function(e){function t(e,n){var o;d()(this,t),o=v()(this,g()(t).call(this,e,n)),N()(E()(o),"squares",void 0),o.squares={};for(var s=0;s<r.BOARD_LENGTH;s++)for(var i=0;i<r.BOARD_LENGTH;i++)o.squares[k([s,i])]={steps:0,score:0};return o}return w()(t,e),y()(t,[{key:"timestep",value:function(e,t,n,r){var o=0,s=new Set,i=new Set,u=k(n),a=k(r);for(this.squares[u].steps=0,this.squares[u].score=A.getManhattanDistance(n,r);u!==a;){i.add(u),s.delete(u);var l=C(u),c=e(l[0],l[1]),f=!0,h=!1,d=void 0;try{for(var p,y=x(c)[Symbol.iterator]();!(f=(p=y.next()).done);f=!0){var m=p.value,v=A.getNewPosition(m,l),b=k(v);i.has(b)||(this.squares[b].steps=this.squares[u].steps+1,this.squares[b].score=this.squares[b].steps+A.getManhattanDistance(v,r),s.add(b))}}catch(e){h=!0,d=e}finally{try{f||null==y.return||y.return()}finally{if(h)throw d}}if(s.size<1)return t(),null;var g=null,_=Number.POSITIVE_INFINITY,E=!0,O=!1,w=void 0;try{for(var T,N=s[Symbol.iterator]();!(E=(T=N.next()).done);E=!0){var P=T.value;this.squares[P].score<_&&(g=P,_=this.squares[P].score)}}catch(e){O=!0,w=e}finally{try{E||null==N.return||N.return()}finally{if(O)throw w}}if(u=g||u,++o>5e3)return t(),null}for(;this.squares[u].steps>1;){var S=null,j=Number.POSITIVE_INFINITY,R=!0,I=!1,F=void 0;try{for(var M,H=i[Symbol.iterator]();!(R=(M=H.next()).done);R=!0){var D=M.value;1===A.getManhattanDistance(C(u),C(D))&&this.squares[D].steps<j&&(S=D,j=this.squares[D].steps)}}catch(e){I=!0,F=e}finally{try{R||null==H.return||H.return()}finally{if(I)throw F}}if(!S)break;u=S}return u?A.getActionFromPositions(n,C(u)):null}}]),t}(A),k=function(e){return 100*e[0]+e[1]},C=function(e){return[(e-e%100)/100,e%100]},D=function(){function e(t){var n=this;d()(this,e),N()(this,"_states",void 0),N()(this,"getKeyFromPositions",function(e,t){return n.getKey(e[0],e[1],t[0],t[1])}),this._states={};for(var o=0;o<r.BOARD_LENGTH;o++)for(var s=0;s<r.BOARD_LENGTH;s++)for(var i=0;i<r.BOARD_LENGTH;i++)for(var u=0;u<r.BOARD_LENGTH;u++)this._states[this.getKey(o,s,i,u)]=t()}return y()(e,[{key:"getState",value:function(e){return this._states[e]}},{key:"getStateFromPositions",value:function(e,t){return this.getState(this.getKeyFromPositions(e,t))}},{key:"getKey",value:function(e,t,n,r){return 1e6*e+1e4*t+100*n+r}}]),e}(),L=function(e){function t(e,n){var r;return d()(this,t),r=v()(this,g()(t).call(this,e,n)),N()(E()(r),"isFleeing",void 0),N()(E()(r),"states",void 0),N()(E()(r),"reset",function(){r.games=0,r.states=new D(function(){return{value:.1*Math.random()}})}),r.isFleeing=e===f.CHICKEN,r.states=new D(function(){return{value:.1*Math.random()}}),r}return w()(t,e),y()(t,[{key:"serialize",value:function(){return{games:this.games,type:this.type,states:this.states._states}}},{key:"deserialize",value:function(e){this.games=e.games,this.states._states=e.states}},{key:"getValues",value:function(e){for(var t=[],n=[],o=0;o<r.BOARD_LENGTH;o++)for(var s=0;s<r.BOARD_LENGTH;s++){t[o]||(t[o]=[]);var i=this.states.getKey(o,s,e[0],e[1]),u=this.states.getState(i).value;t[o].push(u),n.push(u)}n.sort(function(e,t){return e-t});for(var a=0;a<r.BOARD_LENGTH;a++)for(var l=0;l<r.BOARD_LENGTH;l++)t[a][l]=n.indexOf(t[a][l])/(n.length-1);return t}},{key:"getReward",value:function(e){return this.isFleeing?1==e?-1e3:0:1==e?1e3:0}},{key:"timestep",value:function(e,t,n,r){var o=e(n[0],n[1]);o.push(null);var s,i=1/Math.sqrt(this.games);s=Math.random()<i?this.chooseActionRandomly(o):this.chooseActionGreedily(o,n,r);var u=A.getNewPosition(s,n),a=A.getManhattanDistance(n,r),l=this.getReward(a),c=this.states.getStateFromPositions(n,r).value,f=c+.9*(l+.9*this.states.getStateFromPositions(u,r).value-c);return this.states.getStateFromPositions(n,r).value=f,s}},{key:"chooseActionRandomly",value:function(e){return I(e)}},{key:"chooseActionGreedily",value:function(e,t,n){var r=null,o=Number.NEGATIVE_INFINITY,s=!0,i=!1,u=void 0;try{for(var a,l=e[Symbol.iterator]();!(s=(a=l.next()).done);s=!0){var c=a.value,f=void 0;f=c?A.getNewPosition(c,t):t;var h=this.states.getStateFromPositions(f,n).value;h>o&&(o=h,r=c,f)}}catch(e){i=!0,u=e}finally{try{s||null==l.return||l.return()}finally{if(i)throw u}}return r}}]),t}(A),G=function(e){switch(e){case"CHICKEN_TEMPORAL_DIFFERENCE":return new L(f.CHICKEN,e);case"FOX_TEMPORAL_DIFFERENCE":return new L(f.FOX,e);case"CHICKEN_RANDOM":return new M(f.CHICKEN,e);case"FOX_RANDOM":return new M(f.FOX,e);case"FOX_GREEDY":return new F(f.FOX,e);case"CHICKEN_GREEDY":return new F(f.CHICKEN,e);case"CHICKEN_PLAYER":return new S(f.CHICKEN,e);case"FOX_PLAYER":return new S(f.FOX,e);case"FOX_A_STAR":return new H(f.FOX,e);default:throw Error("Actor type ".concat(e," not recognized"))}},K=function e(t,n,o){var h=this;d()(this,e),N()(this,"grid",void 0),N()(this,"heroIdx",void 0),N()(this,"actors",void 0),N()(this,"gameIterations",void 0),N()(this,"getValues",function(){if(!h.heroIdx)return null;var e=h.actors[h.heroIdx],t=h.actors[1-h.heroIdx];return e.getValues(t.position)}),N()(this,"reset",function(){var e=!0,t=!1,n=void 0;try{for(var r,o=h.actors[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;s.endGame(),h._clearPosition(s.position),s.position=h._getRandomPosition(),h._setPosition(s)}}catch(e){t=!0,n=e}finally{try{e||null==o.return||o.return()}finally{if(t)throw n}}}),N()(this,"run",function(e){return h._run(e)}),N()(this,"_run",function(e){h.gameIterations++;var t=null,n=!0,r=!1,o=void 0;try{for(var i,u=h.actors.entries()[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var a=R()(i.value,2),l=(a[0],a[1]),c=t||h.actors[1].position,f=l.timestep(h._getActions,e,l.position,c);t=l.position,h._move(l,f)}}catch(e){r=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(r)throw o}}(h.gameIterations>=s||q(h.actors[0].position,h.actors[1].position)<2)&&(h.gameIterations=0,e())}),N()(this,"_move",function(e,t){t&&(h._clearPosition(e.position),e.position[0]+=c[t][0],e.position[1]+=c[t][1],h._setPosition(e))}),N()(this,"_getRandomPosition",function(){for(var e=[0,0];e=[B(),B()],h.grid[e[0]][e[1]]!==f.EMPTY;);return e}),N()(this,"_getActions",function(e,t){var n=[],o=r.BOARD_LENGTH-1;return e<0||t<0||t>o||e>o?n:(e>0&&h.grid[e-1][t]!==f.TREE&&n.push(i),e<o&&h.grid[e+1][t]!==f.TREE&&n.push(u),t>0&&h.grid[e][t-1]!==f.TREE&&n.push(l),t<o&&h.grid[e][t+1]!==f.TREE&&n.push(a),n)}),N()(this,"_setPosition",function(e){h.grid[e.position[0]][e.position[1]]=e.sprite}),N()(this,"_clearPosition",function(e){h.grid[e[0]][e[1]]=f.EMPTY}),this.grid=t,this.gameIterations=0,this.actors=n,this.heroIdx=o;var p=!0,y=!1,m=void 0;try{for(var v,b=this.actors[Symbol.iterator]();!(p=(v=b.next()).done);p=!0){var g=v.value,_=this._getRandomPosition();g.position=_,this._setPosition(g)}}catch(e){y=!0,m=e}finally{try{p||null==b.return||b.return()}finally{if(y)throw m}}},q=function(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])},B=function(){return Math.floor(Math.random()*r.BOARD_LENGTH)},X=!1;onmessage=function(e){if(!X){X=!0;for(var t=e.data,n=t.actorMessages,r=t.grid,s=[G(n[0].type),G(n[1].type)],i=new K(r),u=0;u<o;u++)i.run(i.reset),u%1e3==0&&postMessage({done:!1,progress:Math.floor(100*u/o)});postMessage({done:!0,progress:100,actorMessages:[s[0].serialize(),s[1].serialize()]}),X=!1}}}});